// Generated by CoffeeScript 1.11.1
(function() {
  var renderTask;

  renderTask = function(task) {
    var progress;
    $('.task-status').text(task.status);
    progress = $('.progress');
    if (!task.start_dt || task.finish_dt) {
      progress.hide();
    } else {
      progress.show();
      progress.find('.progress-bar').attr('aria-valuenow', task.percent).css('width', task.percent + "%").text(task.percent + "%");
    }
    $('.start-dt').text(task.start_dt_rus);
    $('.finish-dt').text(task.finish_dt_rus);
    $('button[name=cancel]').prop('disabled', task.start_dt_rus);
    $('button[name=restart]').prop('disabled', task.in_progress);
    if (task.result_attachment) {
      $('.result-attachment').show();
      $('.result-attachment').prop('href', task.result_attachment);
    } else {
      $('.result-attachment').hide();
    }
    return $('#logs').load(window.location.href + ' #logs');
  };

  this.loadTask = function() {
    var url;
    url = "/background_tasks/rest/task/" + taskId + "/";
    return $.ajax({
      method: 'get',
      url: url,
      success: function(task) {
        renderTask(task);
        return setTimeout(loadTask, 1000);
      }
    });
  };

  $(function() {
    return loadTask();
  });

}).call(this);
